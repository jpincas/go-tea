(()=>{var e,t,n="undefined"==typeof document?void 0:document,o=!!n&&"content"in n.createElement("template"),a=!!n&&n.createRange&&"createContextualFragment"in n.createRange();function r(e,t){var n,o,a=e.nodeName,r=t.nodeName;return a===r||((n=a.charCodeAt(0),o=r.charCodeAt(0),n<=90&&o>=97)?a===r.toUpperCase():o<=90&&n>=97&&r===a.toUpperCase())}function i(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var o=n.nodeName.toUpperCase();"OPTGROUP"===o&&(o=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==o||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}i(e,t,"selected")},INPUT:function(e,t){i(e,t,"checked"),i(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var o=e.firstChild;if(o){var a=o.nodeValue;if(a==n||!n&&a==e.placeholder)return;o.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,o,a=-1,r=0,i=e.firstChild;i;)if("OPTGROUP"===(o=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===o){if(i.hasAttribute("selected")){a=r;break}r++}(i=i.nextSibling)||!n||(i=n.nextSibling,n=null)}e.selectedIndex=a}}};function d(){}function s(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var c=(t=function(e,t){var n,o,a,r,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var l=i.length-1;l>=0;l--)o=(n=i[l]).name,a=n.namespaceURI,r=n.value,a?(o=n.localName||o,e.getAttributeNS(a,o)!==r&&("xmlns"===n.prefix&&(o=n.name),e.setAttributeNS(a,o,r))):e.getAttribute(o)!==r&&e.setAttribute(o,r);for(var d=e.attributes,s=d.length-1;s>=0;s--)o=(n=d[s]).name,(a=n.namespaceURI)?(o=n.localName||o,t.hasAttributeNS(a,o)||e.removeAttributeNS(a,o)):t.hasAttribute(o)||e.removeAttribute(o)}},function(i,c,u){if(u||(u={}),"string"==typeof c)if("#document"===i.nodeName||"HTML"===i.nodeName||"BODY"===i.nodeName){var f,m,p,v,g,h,N,b,S=c;(c=n.createElement("html")).innerHTML=S}else{f=(f=c).trim(),c=o?(m=f,(p=n.createElement("template")).innerHTML=m,p.content.childNodes[0]):a?(v=f,e||(e=n.createRange()).selectNode(n.body),e.createContextualFragment(v).childNodes[0]):(g=f,(h=n.createElement("body")).innerHTML=g,h.childNodes[0])}else 11===c.nodeType&&(c=c.firstElementChild);var A=u.getNodeKey||s,E=u.onBeforeNodeAdded||d,T=u.onNodeAdded||d,C=u.onBeforeElUpdated||d,y=u.onElUpdated||d,w=u.onBeforeNodeDiscarded||d,O=u.onNodeDiscarded||d,x=u.onBeforeElChildrenUpdated||d,k=u.skipFromChildren||d,U=u.addChild||function(e,t){return e.appendChild(t)},$=!0===u.childrenOnly,R=Object.create(null),I=[];function V(e){I.push(e)}function L(e,t,n){!1!==w(e)&&(t&&t.removeChild(e),O(e),function e(t,n){if(1===t.nodeType)for(var o=t.firstChild;o;){var a=void 0;n&&(a=A(o))?V(a):(O(o),o.firstChild&&e(o,n)),o=o.nextSibling}}(e,n))}function _(e){if(1===e.nodeType||11===e.nodeType)for(var t=e.firstChild;t;){var n=A(t);n&&(R[n]=t),_(t),t=t.nextSibling}}_(i);var M=i,B=M.nodeType,F=c.nodeType;if(!$){if(1===B)1===F?r(i,c)||(O(i),M=function(e,t){for(var n=e.firstChild;n;){var o=n.nextSibling;t.appendChild(n),n=o}return t}(i,(N=c.nodeName,(b=c.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==b?n.createElementNS(b,N):n.createElement(N)))):M=c;else if(3===B||8===B)if(F===B)return M.nodeValue!==c.nodeValue&&(M.nodeValue=c.nodeValue),M;else M=c}if(M===c)O(i);else{if(c.isSameNode&&c.isSameNode(M))return;if(function e(o,a,i){var d=A(a);if(d&&delete R[d],!i){var s=C(o,a);if(!1===s)return;if(s instanceof HTMLElement&&_(o=s),t(o,a),y(o),!1===x(o,a))return}"TEXTAREA"!==o.nodeName?function(t,o){var a,i,d,s,c,u=k(t,o),f=o.firstChild,m=t.firstChild;e:for(;f;){for(s=f.nextSibling,a=A(f);!u&&m;){if(d=m.nextSibling,f.isSameNode&&f.isSameNode(m)){f=s,m=d;continue e}i=A(m);var p=m.nodeType,v=void 0;if(p===f.nodeType&&(1===p?(a?a!==i&&((c=R[a])?d===c?v=!1:(t.insertBefore(c,m),i?V(i):L(m,t,!0),i=A(m=c)):v=!1):i&&(v=!1),(v=!1!==v&&r(m,f))&&e(m,f)):(3===p||8==p)&&(v=!0,m.nodeValue!==f.nodeValue&&(m.nodeValue=f.nodeValue))),v){f=s,m=d;continue e}i?V(i):L(m,t,!0),m=d}if(a&&(c=R[a])&&r(c,f))u||U(t,c),e(c,f);else{var g=E(f);!1!==g&&(g&&(f=g),f.actualize&&(f=f.actualize(t.ownerDocument||n)),U(t,f),function t(n){T(n);for(var o=n.firstChild;o;){var a=o.nextSibling,i=A(o);if(i){var l=R[i];l&&r(o,l)?(o.parentNode.replaceChild(l,o),e(l,o)):t(o)}else t(o);o=a}}(f))}f=s,m=d}for(var h=m,N=i;h;){var b=h.nextSibling;(N=A(h))?V(N):L(h,t,!0),h=b}var S=l[t.nodeName];S&&S(t,o)}(o,a):l.TEXTAREA(o,a)}(M,c,$),I)for(var H=0,P=I.length;H<P;H++){var W=R[I[H]];W&&L(W,W.parentNode,!1)}}return!$&&M!==i&&i.parentNode&&(M.actualize&&(M=M.actualize(i.ownerDocument||n)),i.parentNode.replaceChild(M,i)),M});let u="Sent Message:";function f(e){let t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}console.log("Attempting to establish WebSocket connection");let m=function(e){try{return localStorage.getItem(`gotea_state_${e}`)||null}catch(e){return console.warn("Failed to retrieve state:",e),null}}(f("session_id")),p=m?`&restored_state=${encodeURIComponent(m)}`:"",v=new WebSocket(`${"https:"===window.location.protocol?"wss://":"ws://"}${window.location.host}/server?whence=${document.location.pathname}${p}`);v.onmessage=e=>{let t=e.data;try{let e=JSON.parse(t);if("STATE_SNAPSHOT"===e.type){var n=f("session_id"),o=e.data;try{localStorage.setItem(`gotea_state_${n}`,o)}catch(e){console.warn("Failed to store state:",e)}return}}catch(e){}console.log("Received rerender from server"),c(document.documentElement,e.data,{childrenOnly:!0})},v.onopen=()=>{console.log("WebSocket connection established.")},v.onerror=e=>{console.error("WebSocket error:",e)},v.onclose=e=>{e.wasClean?console.log(`WebSocket connection closed cleanly, code=${e.code}, reason=${e.reason}`):console.error("WebSocket connection closed unexpectedly, code=",e.code,"reason=",e.reason)};window.gotea={sendMessage:e=>{let t=JSON.stringify(e);console.log(`${u}`,t),v.send(t)},updateFormState:(e,t)=>{var n;n=t,e.args=[...document.getElementById(n).elements].reduce((e,t)=>{switch(t.tagName){case"SELECT":let n;e[t.name]=(n=t).multiple?[...n.children].map(e=>e.selected?e.value:"").filter(e=>e.length>0):n.value;break;case"TEXTAREA":e[t.name]=t.value}switch(t.type){case"text":e[t.name]=t.value;break;case"checkbox":e[t.name]=t.checked;break;case"radio":t.checked&&(e[t.name]=t.value)}return e},{}),console.log(`${u}`,e),v.send(JSON.stringify(e))},sendMessageWithValueFromInput:(e,t)=>{e.args=document.getElementById(t).value;let n=JSON.stringify(e);console.log(`${u}`,n),v.send(n)},sendMessageWithValueFromThisInput:e=>{e.args=document.activeElement.value;let t=JSON.stringify(e);console.log(`${u}`,t),v.send(t)}},window.addEventListener("popstate",e=>{let t={message:"CHANGE_ROUTE",args:document.location.pathname};console.log(`${u}`,t),v.send(JSON.stringify(t))}),document.addEventListener("click",e=>{let t=e.target;for(;t&&"A"!==t.tagName;)t=t.parentElement;if(t&&!/external/.test(t.className)){var n;let o;return e.preventDefault(),n=t.getAttribute("href"),history.pushState({},"",n),console.log(`${u}`,o={message:"CHANGE_ROUTE",args:n}),v.send(JSON.stringify(o)),!1}},!1)})();
//# sourceMappingURL=main.js.map
