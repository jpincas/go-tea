(()=>{var e,t,n="u"<typeof document?void 0:document,o=!!n&&"content"in n.createElement("template"),a=!!n&&n.createRange&&"createContextualFragment"in n.createRange();function r(e,t){var n,o,a=e.nodeName,r=t.nodeName;return a===r||((n=a.charCodeAt(0),o=r.charCodeAt(0),n<=90&&o>=97)?a===r.toUpperCase():o<=90&&n>=97&&r===a.toUpperCase())}function i(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var o=n.nodeName.toUpperCase();"OPTGROUP"===o&&(o=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==o||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}i(e,t,"selected")},INPUT:function(e,t){i(e,t,"checked"),i(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var o=e.firstChild;if(o){var a=o.nodeValue;if(a==n||!n&&a==e.placeholder)return;o.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,o,a=-1,r=0,i=e.firstChild;i;)if("OPTGROUP"===(o=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===o){if(i.hasAttribute("selected")){a=r;break}r++}(i=i.nextSibling)||!n||(i=n.nextSibling,n=null)}e.selectedIndex=a}}};function c(){}function d(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var s=(t=function(e,t){var n,o,a,r,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var l=i.length-1;l>=0;l--)o=(n=i[l]).name,a=n.namespaceURI,r=n.value,a?(o=n.localName||o,e.getAttributeNS(a,o)!==r&&("xmlns"===n.prefix&&(o=n.name),e.setAttributeNS(a,o,r))):e.getAttribute(o)!==r&&e.setAttribute(o,r);for(var c=e.attributes,d=c.length-1;d>=0;d--)o=(n=c[d]).name,(a=n.namespaceURI)?(o=n.localName||o,t.hasAttributeNS(a,o)||e.removeAttributeNS(a,o)):t.hasAttribute(o)||e.removeAttribute(o)}},function(i,s,u){if(u||(u={}),"string"==typeof s)if("#document"===i.nodeName||"HTML"===i.nodeName||"BODY"===i.nodeName){var f,m,p,g,v,h,N,b,S=s;(s=n.createElement("html")).innerHTML=S}else{f=(f=s).trim(),s=o?(m=f,(p=n.createElement("template")).innerHTML=m,p.content.childNodes[0]):a?(g=f,e||(e=n.createRange()).selectNode(n.body),e.createContextualFragment(g).childNodes[0]):(v=f,(h=n.createElement("body")).innerHTML=v,h.childNodes[0])}else 11===s.nodeType&&(s=s.firstElementChild);var A=u.getNodeKey||d,T=u.onBeforeNodeAdded||c,E=u.onNodeAdded||c,C=u.onBeforeElUpdated||c,y=u.onElUpdated||c,w=u.onBeforeNodeDiscarded||c,O=u.onNodeDiscarded||c,x=u.onBeforeElChildrenUpdated||c,k=u.skipFromChildren||c,$=u.addChild||function(e,t){return e.appendChild(t)},U=!0===u.childrenOnly,R=Object.create(null),I=[];function V(e){I.push(e)}function M(e,t,n){!1!==w(e)&&(t&&t.removeChild(e),O(e),function e(t,n){if(1===t.nodeType)for(var o=t.firstChild;o;){var a=void 0;n&&(a=A(o))?V(a):(O(o),o.firstChild&&e(o,n)),o=o.nextSibling}}(e,n))}function L(e){if(1===e.nodeType||11===e.nodeType)for(var t=e.firstChild;t;){var n=A(t);n&&(R[n]=t),L(t),t=t.nextSibling}}L(i);var W=i,_=W.nodeType,P=s.nodeType;if(!U){if(1===_)1===P?r(i,s)||(O(i),W=function(e,t){for(var n=e.firstChild;n;){var o=n.nextSibling;t.appendChild(n),n=o}return t}(i,(N=s.nodeName,(b=s.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==b?n.createElementNS(b,N):n.createElement(N)))):W=s;else if(3===_||8===_)if(P===_)return W.nodeValue!==s.nodeValue&&(W.nodeValue=s.nodeValue),W;else W=s}if(W===s)O(i);else{if(s.isSameNode&&s.isSameNode(W))return;if(function e(o,a,i){var c=A(a);if(c&&delete R[c],!i){var d=C(o,a);if(!1===d)return;if(d instanceof HTMLElement&&L(o=d),t(o,a),y(o),!1===x(o,a))return}"TEXTAREA"!==o.nodeName?function(t,o){var a,i,c,d,s,u=k(t,o),f=o.firstChild,m=t.firstChild;e:for(;f;){for(d=f.nextSibling,a=A(f);!u&&m;){if(c=m.nextSibling,f.isSameNode&&f.isSameNode(m)){f=d,m=c;continue e}i=A(m);var p=m.nodeType,g=void 0;if(p===f.nodeType&&(1===p?(a?a!==i&&((s=R[a])?c===s?g=!1:(t.insertBefore(s,m),i?V(i):M(m,t,!0),i=A(m=s)):g=!1):i&&(g=!1),(g=!1!==g&&r(m,f))&&e(m,f)):(3===p||8==p)&&(g=!0,m.nodeValue!==f.nodeValue&&(m.nodeValue=f.nodeValue))),g){f=d,m=c;continue e}i?V(i):M(m,t,!0),m=c}if(a&&(s=R[a])&&r(s,f))u||$(t,s),e(s,f);else{var v=T(f);!1!==v&&(v&&(f=v),f.actualize&&(f=f.actualize(t.ownerDocument||n)),$(t,f),function t(n){E(n);for(var o=n.firstChild;o;){var a=o.nextSibling,i=A(o);if(i){var l=R[i];l&&r(o,l)?(o.parentNode.replaceChild(l,o),e(l,o)):t(o)}else t(o);o=a}}(f))}f=d,m=c}for(var h=m,N=i;h;){var b=h.nextSibling;(N=A(h))?V(N):M(h,t,!0),h=b}var S=l[t.nodeName];S&&S(t,o)}(o,a):l.TEXTAREA(o,a)}(W,s,U),I)for(var B=0,F=I.length;B<F;B++){var H=R[I[B]];H&&M(H,H.parentNode,!1)}}return!U&&W!==i&&i.parentNode&&(W.actualize&&(W=W.actualize(i.ownerDocument||n)),i.parentNode.replaceChild(W,i)),W});let u="Sent Message:";function f(e){let t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}let m=null,p=1e3,g=null;function v(e){return m&&m.readyState===WebSocket.OPEN?(m.send(e),!0):(console.warn("WebSocket not connected. Message queued for reconnection."),!1)}!function e(){let t,n;console.log("Attempting to establish WebSocket connection"),(m=new WebSocket((n=(t=function(e){try{return localStorage.getItem(`gotea_state_${e}`)||null}catch(e){return console.warn("Failed to retrieve state:",e),null}}(f("session_id")))?`&restored_state=${encodeURIComponent(t)}`:"",`${"https:"===window.location.protocol?"wss://":"ws://"}${window.location.host}/server?whence=${document.location.pathname}${n}`))).onmessage=e=>{let t=e.data;try{let e=JSON.parse(t);if("STATE_SNAPSHOT"===e.type){var n=f("session_id"),o=e.data;try{localStorage.setItem(`gotea_state_${n}`,o)}catch(e){console.warn("Failed to store state:",e)}return}}catch(e){}console.log("Received rerender from server"),s(document.documentElement,e.data,{childrenOnly:!0})},m.onopen=()=>{console.log("WebSocket connection established."),p=1e3},m.onerror=e=>{console.error("WebSocket error:",e)},m.onclose=t=>{t.wasClean?console.log(`WebSocket connection closed cleanly, code=${t.code}, reason=${t.reason}`):console.error("WebSocket connection closed unexpectedly, code=",t.code,"reason=",t.reason),g&&clearTimeout(g),console.log(`Scheduling reconnection in ${p}ms...`),g=setTimeout(()=>{console.log("Attempting to reconnect..."),e(),p=Math.min(2*p,3e4)},p)}}();window.gotea={sendMessage:e=>{let t=JSON.stringify(e);console.log(`${u}`,t),v(t)},updateFormState:(e,t)=>{var n;n=t,e.args=[...document.getElementById(n).elements].reduce((e,t)=>{switch(t.tagName){case"SELECT":let n;e[t.name]=(n=t).multiple?[...n.children].map(e=>e.selected?e.value:"").filter(e=>e.length>0):n.value;break;case"TEXTAREA":e[t.name]=t.value}switch(t.type){case"text":e[t.name]=t.value;break;case"checkbox":e[t.name]=t.checked;break;case"radio":t.checked&&(e[t.name]=t.value)}return e},{}),console.log(`${u}`,e),v(JSON.stringify(e))},sendMessageWithValueFromInput:(e,t)=>{e.args=document.getElementById(t).value;let n=JSON.stringify(e);console.log(`${u}`,n),v(n)},sendMessageWithValueFromThisInput:e=>{e.args=document.activeElement.value;let t=JSON.stringify(e);console.log(`${u}`,t),v(t)}},window.addEventListener("popstate",e=>{let t={message:"CHANGE_ROUTE",args:document.location.pathname};console.log(`${u}`,t),v(JSON.stringify(t))}),document.addEventListener("click",e=>{let t=e.target;for(;t&&"A"!==t.tagName;)t=t.parentElement;if(t&&!/external/.test(t.className)){var n;let o;return e.preventDefault(),n=t.getAttribute("href"),history.pushState({},"",n),console.log(`${u}`,o={message:"CHANGE_ROUTE",args:n}),v(JSON.stringify(o)),!1}},!1)})();
//# sourceMappingURL=main.js.map
